<%- include('../partials/head', { title: title }) %>
  <body class="bg-dark font-raleway">
    <%- include('../partials/header') %>

    <main class="cart-container bg-white">
      <section>
        <div class="max-w-[1440px] mx-auto px-[75px]">
          <p class="command-line text-base font-medium opacity-[.61] pt-[67px] pb-[50px]">
            . . /
            <span class="underline">Корзина</span>
          </p>

          <h1 class="hidden text-white">SOME BY MI</h1>

          <h2 class="text-3xl mb-[40px]">Ваша корзина (<%= cartItemCount %>)</h2>

          <% if (items.length > 0) { %>
          <div class="cart-items">
            <% items.forEach(item => { %>
            <div class="cart-item">
              <a href="/products/<%= item.product_id %>">
                <img
                  src="<%= item.image_url || '/images/no-image.png' %>"
                  alt="<%= item.name %>"
                />
              </a>
              <div class="item-details">
                <h3><%= item.name %></h3>
                <div class="quantity-control">
                  <form
                    action="/cart/update/<%= item.id %>"
                    method="POST"
                    class="quantity-form"
                  >
                    <button type="button" class="quantity-btn minus">-</button>
                    <input
                      type="number"
                      name="quantity"
                      value="<%= item.quantity %>"
                      min="1"
                      class="quantity-input"
                    />
                    <button type="button" class="quantity-btn plus">+</button>
                  </form>
                </div>
                <p class="price"><%= parseFloat(item.price).toFixed(2) %> ₽</p>
                <p class="total">
                  Итого: <%= (parseFloat(item.price) * item.quantity).toFixed(2) %>
                  ₽
                </p>
              </div>
              <form action="/cart/remove/<%= item.id %>" method="POST">
                <button type="submit" class="remove-btn">×</button>
              </form>
            </div>
            <% }); %>
          </div>

          <div class="cart-summary">
            <h3>Итого: <span><%= total %> ₽</span></h3>
            <form action="/cart/checkout" method="POST">
              <button type="submit" class="checkout-btn">Оформить заказ</button>
            </form>
          </div>
          <% } else { %>
          <p class="empty-cart text-center text-2xl font-light">Ваша корзина пуста!</p>
          <div class="py-[50px]">
            <a href="/products"
              class="uppercase bg-darkmud text-white mx-auto block w-[270px] h-[56px] rounded-[30px] py-[19px] px-[50px] hover:bg-darkmuddeactivated transition">
              Перейти в каталог
            </a>
          </div>
          <% } %>
        </div>
      </section>
    </main>
    <script src="/js/cart.js" defer></script>
<%- include('../partials/footer') %>
